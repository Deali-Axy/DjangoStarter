# Context
Filename: django_starter_cli_implementation.md
Created On: 2025-01-27
Created By: AI Assistant
Associated Protocol: RIPER-5 + Multidimensional + Agent Protocol

# Task Description
用户询问方案一（Python包 + CLI工具）的具体实现方法，需要详细说明如何将DjangoStarter项目转换为类似django-admin startproject的CLI工具。

# Project Overview
DjangoStarter是一个功能完整的Django项目模板，包含：
- PDM包管理
- Django-split-settings配置管理
- Docker容器化部署
- 前端构建流程（Node.js + pnpm）
- 丰富的Django扩展功能

---
*The following sections are maintained by the AI during protocol execution*
---

# Analysis (Populated by RESEARCH mode)

## 项目结构分析
- **核心配置文件**: pyproject.toml, .env.example, docker-compose.yml
- **Django配置**: src/config/settings/ 目录下的分层配置
- **应用结构**: src/apps/ 和 src/django_starter/ 的模块化组织
- **前端资源**: package.json, tailwind.config.js, gulpfile.js
- **容器化**: Dockerfile, nginx.conf.template
- **文档**: README.md, docs/ 目录

## 模板化需求分析
1. **项目名称替换**: 需要在多个文件中替换项目名称
2. **配置参数化**: 数据库、缓存、第三方服务等配置选项
3. **可选功能**: 用户可选择是否包含某些功能模块
4. **环境配置**: 开发、生产环境的不同配置

# Proposed Solution (Populated by INNOVATE mode)

## 方案一：Python包 + CLI工具详细设计

### 技术架构选择

**核心技术栈**:
- **Click**: 用于构建CLI界面，提供丰富的命令行交互功能
- **Jinja2**: 模板引擎，用于文件内容的动态生成
- **Cookiecutter**: 可选，用于项目结构模板化
- **setuptools**: 包管理和分发

### 实现方式对比

**方式A: 纯CLI工具**
- 优点: 轻量级，易于维护
- 缺点: 功能相对简单
- 适用场景: 快速项目生成

**方式B: CLI + 交互式配置**
- 优点: 用户体验好，配置灵活
- 缺点: 开发复杂度较高
- 适用场景: 需要详细配置的项目

**方式C: CLI + Web界面**
- 优点: 最佳用户体验
- 缺点: 开发成本最高
- 适用场景: 企业级项目模板

### 推荐方案: 方式B (CLI + 交互式配置)

**项目结构设计**:
```
django-starter-cli/
├── django_starter_cli/
│   ├── __init__.py
│   ├── cli.py              # 主CLI入口
│   ├── commands/
│   │   ├── __init__.py
│   │   ├── startproject.py # startproject命令
│   │   └── utils.py        # 工具函数
│   ├── templates/          # 项目模板文件
│   │   ├── project_template/
│   │   └── cookiecutter.json
│   └── config/
│       ├── __init__.py
│       └── settings.py     # CLI配置
├── setup.py
├── pyproject.toml
└── README.md
```

**核心功能设计**:

1. **命令结构**:
   ```bash
   django-starter startproject myproject
   django-starter startproject myproject --interactive
   django-starter startproject myproject --template=api-only
   ```

2. **交互式配置**:
   - 项目名称和描述
   - 数据库选择 (SQLite/PostgreSQL/MySQL)
   - 缓存配置 (Redis/Memcached/None)
   - 第三方服务集成 (微信登录、支付等)
   - 容器化选项 (Docker/Docker Compose)
   - 前端框架选择 (Tailwind/Bootstrap/None)

3. **模板变量系统**:
   ```python
   template_vars = {
       'project_name': 'MyProject',
       'project_slug': 'my_project',
       'author_name': 'Developer',
       'author_email': 'dev@example.com',
       'database_engine': 'postgresql',
       'use_redis': True,
       'use_docker': True,
       'enable_oauth': False
   }
   ```

### 实现优势

1. **用户体验**: 类似django-admin的熟悉界面
2. **灵活性**: 支持多种配置选项和模板
3. **可扩展性**: 易于添加新的项目模板
4. **维护性**: 模块化设计，便于维护和更新

# Implementation Plan (Generated by PLAN mode)

## 详细实现步骤

### 第一阶段：CLI工具基础架构

**目标**: 创建基础的CLI工具框架

**技术要求**:
- 使用Click框架构建CLI
- 设置项目包结构
- 实现基础的命令路由

### 第二阶段：模板系统设计

**目标**: 将现有DjangoStarter项目转换为Jinja2模板

**关键任务**:
1. 识别需要模板化的文件
2. 设计模板变量系统
3. 创建条件渲染逻辑

### 第三阶段：交互式配置系统

**目标**: 实现用户友好的配置收集界面

**功能特性**:
- 命令行参数解析
- 交互式问答系统
- 配置验证和默认值

### 第四阶段：项目生成引擎

**目标**: 实现完整的项目生成功能

**核心功能**:
- 文件复制和渲染
- 目录结构创建
- 后处理脚本执行

## Implementation Checklist:

### 阶段1: CLI基础架构 (1-10)
1. 创建django-starter-cli项目目录结构
2. 设置pyproject.toml配置文件，定义项目元数据和依赖
3. 创建django_starter_cli/__init__.py，定义包版本和基础信息
4. 实现django_starter_cli/cli.py主入口文件，使用Click框架
5. 创建django_starter_cli/commands/__init__.py命令模块初始化
6. 实现django_starter_cli/commands/startproject.py核心命令
7. 创建django_starter_cli/commands/utils.py工具函数模块
8. 设置django_starter_cli/config/settings.py CLI配置管理
9. 创建setup.py文件，配置包安装和入口点
10. 实现基础的命令行参数解析和帮助系统

### 阶段2: 模板系统 (11-25)
11. 分析当前DjangoStarter项目，识别所有需要模板化的文件
12. 创建django_starter_cli/templates/project_template/目录结构
13. 将pyproject.toml转换为Jinja2模板，支持项目名称和依赖配置
14. 将.env.example转换为模板，支持环境变量配置
15. 将docker-compose.yml转换为模板，支持服务配置选项
16. 将Dockerfile转换为模板，支持Python和Node版本选择
17. 将src/config/settings/components/django_starter.py转换为模板
18. 将src/config/settings/components/common.py转换为模板
19. 将package.json转换为模板，支持前端依赖选择
20. 将README.md转换为模板，支持项目信息自定义
21. 创建模板变量定义文件cookiecutter.json
22. 实现条件渲染逻辑，支持可选功能模块
23. 创建模板验证系统，确保生成的文件语法正确
24. 实现模板继承和包含机制，提高代码复用
25. 测试所有模板文件的渲染功能

### 阶段3: 交互式配置 (26-35)
26. 实现项目基础信息收集（名称、描述、作者）
27. 实现数据库选择交互（SQLite/PostgreSQL/MySQL/Oracle）
28. 实现缓存配置选择（Redis/Memcached/None）
29. 实现第三方服务集成选择（微信登录、支付宝等）
30. 实现容器化选项配置（Docker/Docker Compose/None）
31. 实现前端框架选择（Tailwind CSS/Bootstrap/None）
32. 实现开发工具选择（调试工具、代码格式化等）
33. 添加配置预设模板（API项目、全栈项目、微服务等）
34. 实现配置验证和错误处理
35. 添加配置保存和加载功能

### 阶段4: 项目生成引擎 (36-45)
36. 实现目录结构创建逻辑
37. 实现文件复制和模板渲染引擎
38. 实现条件文件生成（根据用户选择包含/排除文件）
39. 实现文件权限设置（可执行文件等）
40. 实现后处理脚本系统（依赖安装、数据库初始化等）
41. 添加进度显示和用户反馈
42. 实现错误回滚机制
43. 添加生成报告和下一步指导
44. 实现项目验证功能（检查生成的项目是否可运行）
45. 创建完整的使用文档和示例

### 阶段5: 测试和优化 (46-50)
46. 编写单元测试覆盖所有核心功能
47. 编写集成测试验证完整的项目生成流程
48. 性能优化和内存使用优化
49. 添加CI/CD配置，自动化测试和发布
50. 创建用户手册和开发者文档

# Current Execution Step (Updated by EXECUTE mode when starting a step)
[待填充]

# Task Progress (Appended by EXECUTE mode after each step completion)
[待填充]

# Final Review (Populated by REVIEW mode)
[待填充]