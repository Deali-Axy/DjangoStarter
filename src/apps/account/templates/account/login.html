{% extends '_auth_base.html' %}

{% block title %}登录{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="space-y-2">
        <h2 class="text-3xl font-bold">欢迎回来</h2>
        <p class="text-base-content/60">请输入您的账号信息以登录。</p>
    </div>

    {% if sso_url %}
        <a class="btn btn-outline btn-block gap-2 h-12" href="{{ sso_url }}">
            <i class="fa-solid fa-building-shield"></i>
            使用企业账号登录 (SSO)
        </a>
        
        <div class="relative py-2">
            <div class="absolute inset-0 flex items-center">
                <div class="w-full border-t border-base-300"></div>
            </div>
            <div class="relative flex justify-center text-sm">
                <span class="px-2 bg-base-100 text-base-content/50">或者使用邮箱登录</span>
            </div>
        </div>
    {% endif %}

    <form method="post" class="space-y-4" novalidate>
        {% csrf_token %}

        {% if redirect_field_value %}
            <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
        {% endif %}

        {% if form.login %}
            {% include 'account/_components/form_field.html' with field=form.login label='用户名 / 邮箱' %}
        {% else %}
            {% include 'account/_components/form_field.html' with field=form.username %}
        {% endif %}

        <div class="form-control w-full space-y-1" x-data="{ show: false }">
            <div class="flex items-center justify-between">
                <label class="label p-0" for="{{ form.password.id_for_label }}">
                    <span class="label-text font-medium">{{ form.password.label }}</span>
                </label>
                <a class="link link-primary link-hover text-sm font-medium" href="{% url 'account:password-forgot' %}">忘记密码？</a>
            </div>
            <div class="relative">
                <input :type="show ? 'text' : 'password'" 
                       name="{{ form.password.name }}" 
                       id="{{ form.password.id_for_label }}"
                       class="input input-bordered w-full pr-10 {% if form.password.errors %}input-error{% endif %}"
                       required
                       {% if form.password.value %}value="{{ form.password.value }}"{% endif %}>
                <button type="button" 
                        class="absolute right-3 top-1/2 -translate-y-1/2 text-base-content/50 hover:text-base-content"
                        @click="show = !show"
                        tabindex="-1">
                    <i class="fa-solid" :class="show ? 'fa-eye-slash' : 'fa-eye'"></i>
                </button>
            </div>
            {% if form.password.errors %}
                <p class="text-sm text-error mt-1">{{ form.password.errors|join:', ' }}</p>
            {% endif %}
        </div>

        {% if form.non_field_errors %}
            <div role="alert" class="alert alert-error text-sm py-2">
                <i class="fa-solid fa-circle-exclamation"></i>
                <span>{{ form.non_field_errors|join:', ' }}</span>
            </div>
        {% endif %}

        <button type="submit" class="btn btn-primary btn-block btn-lg mt-6">
            登 录
            <i class="fa-solid fa-arrow-right ml-2"></i>
        </button>
    </form>

    <p class="text-center text-sm text-base-content/70">
        还没有账号？
        <a class="link link-primary font-bold" href="{% url 'account:signup' %}">立即注册</a>
    </p>
</div>
{% endblock %}
