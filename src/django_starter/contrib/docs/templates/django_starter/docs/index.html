{% extends "_base.html" %}
{% load static i18n %}

{% block title %}{{ page_title }} - DjangoStarter Docs{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'djs/docs/docs.css' %}">
{% endblock %}

{% block content %}
<div class="mx-auto px-4 py-8 lg:py-12 grid gap-8 lg:grid-cols-[240px_1fr_260px]">
    <!-- Left Sidebar: Navigation -->
    <aside class="space-y-6 hidden lg:block">
        <div class="card bg-base-100 shadow-xl border border-base-200 p-4 sticky top-24">
            <div class="text-xs uppercase tracking-widest text-base-content/50 mb-3">目录导航</div>
            <ul class="menu w-full p-0">
                {% for item in categories %}
                    <li class="menu-title text-base-content/70">{{ item.category.title }}</li>
                    {% for page in item.pages %}
                        <li>
                            <a href="{% url 'djs_docs:detail' slug=page.slug %}"
                               class="{% if active_page and page.slug == active_page.slug %}active{% endif %}">
                                {{ page.title }}
                            </a>
                        </li>
                    {% endfor %}
                {% endfor %}
            </ul>
        </div>

        <div class="card bg-base-100 shadow-xl border border-base-200 p-4">
            <div class="text-sm font-bold text-base-content mb-2">快捷入口</div>
            <ul class="menu w-full p-0">
                <li>
                    <a href="/api/docs" target="_blank">
                        <i class="fas fa-book opacity-50"></i>
                        API Docs
                    </a>
                </li>
                <li>
                    <a href="/admin" target="_blank">
                        <i class="fas fa-user-cog opacity-50"></i>
                        管理后台
                    </a>
                </li>
                <li>
                    <a href="/demo">
                        <i class="fas fa-flask opacity-50"></i>
                        Demo
                    </a>
                </li>
            </ul>
        </div>
    </aside>

    <!-- Mobile Navigation (Drawer Toggle/Menu could go here if needed, but handled by global drawer) -->

    <!-- Main Content -->
    <section class="space-y-6 min-w-0">
        <!-- Header Card -->
        <div class="card bg-base-100 shadow-xl border border-base-200 p-6">
            <div class="flex flex-col gap-2">
                <div class="text-xs uppercase tracking-widest text-base-content/50">文档</div>
                <h1 class="text-3xl font-bold text-base-content">
                    {% if active_page %}{{ active_page.title }}{% else %}文档中心{% endif %}
                </h1>
                {% if active_page %}
                    <p class="text-base-content/70">{{ active_page.summary }}</p>
                {% endif %}
            </div>
            
            <!-- Search Bar (Inline for Docs) -->
            <form method="get" action="{% url 'djs_docs:index' %}" class="mt-6">
                <div class="join w-full">
                    <div class="relative w-full">
                        <input name="q" value="{{ search_query }}" placeholder="搜索文档、关键字或命令"
                               class="input join-item w-full pl-10">
                        <i class="fas fa-search absolute left-3 top-3.5 text-base-content/40"></i>
                    </div>
                    <button class="btn btn-primary join-item">搜索</button>
                </div>
            </form>
        </div>

        {% if search_query %}
            <div class="card bg-base-100 shadow-xl border border-base-200 p-6">
                <div class="text-sm text-base-content/60 mb-4">搜索结果：{{ search_query }}</div>
                {% if search_results %}
                    <div class="space-y-3">
                        {% for result in search_results %}
                            <a href="{% url 'djs_docs:detail' slug=result.slug %}"
                               class="block p-4 rounded-xl border border-base-200 hover:border-primary hover:bg-base-200 transition-colors">
                                <div class="font-bold text-base-content">{{ result.title }}</div>
                                <div class="text-sm text-base-content/70">{{ result.summary }}</div>
                            </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-base-content/60">未找到匹配的文档，请尝试其他关键词。</div>
                {% endif %}
            </div>
        {% endif %}

        <!-- Doc Content -->
        <article class="card bg-base-100 shadow-xl border border-base-200 p-6 sm:p-10 doc-content prose max-w-none prose-img:rounded-xl">
            {{ active_html|safe }}
        </article>
    </section>

    <!-- Right Sidebar: Quick Actions -->
    <aside class="space-y-6 hidden lg:block">
        <div class="card bg-base-100 shadow-xl border border-base-200 p-4">
            <img src="{% static 'djs/docs/docs-hero.svg' %}" alt="Docs Illustration" class="w-full rounded-xl">
        </div>
        <div class="card bg-base-100 shadow-xl border border-base-200 p-5 space-y-4 sticky top-24">
            <div class="text-sm font-bold text-base-content">快捷操作</div>
            <button type="button" data-copy-link
                    class="btn btn-outline btn-sm w-full justify-between">
                复制当前链接
                <i class="fas fa-link"></i>
            </button>
            <a href="https://github.com/Deali-Axy/DjangoStarter" target="_blank"
               class="btn btn-outline btn-sm w-full justify-between">
                访问仓库
                <i class="fab fa-github"></i>
            </a>
            <a href="/api/docs"
               class="btn btn-outline btn-sm w-full justify-between">
                API 文档
                <i class="fas fa-book"></i>
            </a>
            <a href="mailto:dealiaxy@gmail.com"
               class="btn btn-outline btn-sm w-full justify-between">
                反馈建议
                <i class="fas fa-paper-plane"></i>
            </a>
            
            <div class="divider my-2"></div>
            
            <div class="space-y-3">
                <div class="text-sm font-bold text-base-content">阅读进度</div>
                <progress class="progress progress-primary w-full" value="40" max="100"></progress>
                <div class="text-xs text-base-content/50">持续更新中，欢迎关注。</div>
            </div>
        </div>
    </aside>
</div>

<script>
    const copyButton = document.querySelector("[data-copy-link]");
    if (copyButton) {
        copyButton.addEventListener("click", () => {
            navigator.clipboard.writeText(window.location.href);
            const originalHtml = copyButton.innerHTML;
            copyButton.classList.add("btn-success", "text-white");
            copyButton.innerHTML = "已复制链接 <i class='fas fa-check'></i>";
            setTimeout(() => {
                copyButton.classList.remove("btn-success", "text-white");
                copyButton.innerHTML = originalHtml;
            }, 1600);
        });
    }
</script>
{% endblock %}
